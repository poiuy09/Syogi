<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<title>JavaScript将棋盤</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

	<!-- ポーリングできてないし大分よくない -->
	<meta http-equiv="refresh" content="10; URL=">

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<!-- <script type="text/javascript" src="./js/polling.js"></script> -->
	<!-- <script type="text/javascript" src="./js/shogi.js"></script>  -->
	<script type="text/javascript" th:inline="javascript">
	/*<![CDATA[*/

	//コメントをどんどん追加していこう。それで理解していく 関数 定義と呼び出しの区別
	//盤上(と駒台)の状態を表している
	//将棋用語 駒piece 段 rank 筋 file 手 move 手番 the move/ turn /color
	//駒の位置 position 局面 position 持ち駒 captured piece / hand 持ち駒を打つ drop
	//(一つの)駒の位置piecePos グローバル関数,変数かどうかはチェック
	var OUT_OF_BOARD = 128;  //盤上の外(=駒台)
	var EMPTY = 0;  //盤上空
	var FU = 1;  //歩
	var KY = 2;  //香車
	var KE = 3;  //桂馬
	var GI = 4;  //銀
	var KI = 5;  //金
	var KA = 6;  //角
	var HI = 7;  //飛車
	var OU = 8;  //王
	var PROMOTED = 8; //成りの駒に足している
	var TO = PROMOTED + FU;  //と
	var NY = PROMOTED + KY;  //成香
	var NK = PROMOTED + KE;  //成桂
	var NG = PROMOTED + GI;  //成銀
	var UM = PROMOTED + KA;  //馬
	var RY = PROMOTED + HI;  //龍
	var ENEMY = 16;  //敵の駒
	var EFU = ENEMY + FU;  //敵の歩
	var EKY = ENEMY + KY;  //敵の香車
	var EKE = ENEMY + KE;  //敵の桂馬
	var EGI = ENEMY + GI;  //敵の銀
	var EKI = ENEMY + KI;  //敵の金
	var EKA = ENEMY + KA;  //敵の角
	var EHI = ENEMY + HI;  //敵の飛車
	var EOU = ENEMY + OU;  //敵の王
	var ETO = ENEMY + TO;  //敵のと
	var ENY = ENEMY + NY;  //敵の成香
	var ENK = ENEMY + NK;  //敵の成桂
	var ENG = ENEMY + NG;  //敵の成銀
	var EUM = ENEMY + UM;  //敵の馬
	var ERY = ENEMY + RY;  //敵の龍

	//盤上と駒台での見た目が違うからあるだけ。駒そのものを示している変数から画像ファイルを示すためのもの不変
	var piece_board; //盤上の駒の画像のIDを入れておく変数
	var piece_black_capture; //先手の駒台の駒の画像のIDを入れておく変数
	var piece_white_capture; //後手の駒台の駒の画像のIDを入れておく変数
	var piece_promotion_window;  //成／不成を選択するウインドウに表示する駒の画像のIDを入れておく変数
	var promotion_window;  //成／不成を選択するウインドウの画像のIDを入れておく変数

	//可変 非データベース
	var selectedFlgB;  //盤上の駒が選択された状態かどうか
	var selectedFlgC;  //持ち駒が選択された状態かどうか
	var PromotionWindowFlg;  //成／不成を選択するウインドウが表示されているかどうか

	var clickRank,clickFile;  //駒を選択するときにクリックしたマスの段と筋
	var ToClickDan,ToClickSuji;  //用意したけどけっきょく使わなかった

	var selectedPiece; //選択された駒の種類
	var teban;  //手番 trueが先手番  falseが後手番 データベース化したい

	//要素数気になる board,capture
	var board = []; //将棋盤の配列 データベース化

	var capture = []; //持ち駒の配列 データベース化したい

	var slb,slw; //?

	var b; //?

	//方向
	var Direction = [];

	Direction[0]  = new PiecePos(0,1);   //←
	Direction[1]  = new PiecePos(1,1);   //←↓
	Direction[2]  = new PiecePos(1,0);   //↓
	Direction[3]  = new PiecePos(1,-1);  //→↓
	Direction[4]  = new PiecePos(0,-1);  //→
	Direction[5]  = new PiecePos(-1,-1); //→↑
	Direction[6]  = new PiecePos(-1,0);  //↑
	Direction[7]  = new PiecePos(-1,1);  //←↑
	Direction[8]  = new PiecePos(-2,1);  //先手の桂馬飛び
	Direction[9]  = new PiecePos(-2,-1); //先手の桂馬飛び
	Direction[10] = new PiecePos(2,1);   //後手の桂馬飛び
	Direction[11] = new PiecePos(2,-1);  //後手の桂馬飛び

	//各方向に進めるかどうかCanJumpとは重ならないようにできている
	var CanGo = [
	//←
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1
	],

	//←↓
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,1,0,1,0,1,0,0,0,0,0,1,1,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,1,1,1,0,1,1,1,1,1,1,1,1
	],

	//↓
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1
	],

	//→↓
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,1,0,1,0,1,0,0,0,0,0,1,1,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,1,1,1,0,1,1,1,1,1,1,1,1
	],

	//→
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1
	],

	//→↑
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,1,1,1,0,1,1,1,1,1,1,1,1,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,1,0,1,0,1,0,0,0,0,0,1,1
	],

	//↑
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1
	],

	//←↑
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,1,1,1,0,1,1,1,1,1,1,1,1,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,1,0,1,0,1,0,0,0,0,0,1,1
	],

	//先手の桂馬飛び{-2,1}
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	],

	//先手の桂馬飛び{2,1}
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	],

	//後手の桂馬飛び{-2,1}
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0
	],

	//後手の桂馬飛び{2,1}
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0
	],

	];

	//各方向にジャンプできるかどうか(実質角と飛車だけ)
	var CanJump = [
	//←
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1
	],

	//←↓
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0
	],

	//↓
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,1
	],

	//→↓
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0
	],

	//→
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1
	],

	//→↑
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0
	],

	//↑
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,1,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1
	],

	//←↑
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0
	],

	//先手の桂馬飛び{-2,1}
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	],

	//先手の桂馬飛び{2,1}
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	],

	//後手の桂馬飛び{-2,1}
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	],

	//後手の桂馬飛び{2,1}
	[
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	//  歩香桂銀金角飛玉と杏圭全金馬竜
	  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	]

	];
	//関数いろいろ
	//先手の駒かどうか
	var BlackKoma = function(piece){
		return (FU <= piece && piece <= RY);
	}

	//後手の駒かどうか
	var WhiteKoma = function(piece){
		return (EFU <= piece && piece <= ERY);
	}

	var Self = function(piece,turn){
		return (turn) ? BlackKoma(piece) : WhiteKoma(piece);
	}

	var Enemy = function(piece,turn){
		return (!turn) ? BlackKoma(piece) : WhiteKoma(piece);
	}

	//成ることができる駒かどうか
	//a & b :ビット論理積 , ~ チルダ演算子 ただの変数名ではない! 16で割ったあまりが1,2,3,4,6,7のもの
	//kはローカル変数number pieceはanyのparameter
	var CanPromoteKoma = function(piece){
		var k = piece & ~ENEMY;
		return (FU <= k && k <= HI && k != KI && k != OU);
	}

	//駒かどうか
	var Koma = function(piece){
		return ((FU <= piece && piece <= RY) || (EFU <= piece && piece <= ERY));
	}

	//先手の陣地かどうか 位=rank将棋の位取り,みたいな高さのこと
	//横は筋,英語にしづらいからfileなのかな
	var BlackArea = function(rank,file){
		return (7 <= rank && rank <= 9 && 1 <= file && file <= 9);
	}

	//後手の陣地かどうか
	var WhiteArea = function(rank,file){
		return (1 <= rank && rank <= 3 && 1 <= file && file <= 9);
	}

	//盤上のマスがどうか　番兵おいたからつくった意味があまりない関数
	var WithinBoard = function(pos){
		return (1 <= pos.rank && pos.rank <= 9 && 1 <= pos.file && pos.file <= 9);
	}

	//成ることができるかどうか
	var CanPromote = function(piece,teban,rank,file){
		return (CanPromoteKoma(piece) && (BlackKoma(piece) && WhiteArea(rank,file) || WhiteKoma(piece) && BlackArea(rank,file)));
	}

	var MustPromote = function(piece,turn,rank,file){
		if((piece & ~ENEMY) == KY || (piece & ~ENEMY) == FU){
			if(turn && rank <= 1)return 1;
			if(!turn && rank >= 9)return 1;
		}

		if((piece & ~ENEMY) == KE){
			if(turn && rank <= 2)return 1;
			if(!turn && rank >= 8)return 1;
		}

		return 0;

	}


	//選択した駒が、選択したマスに動けるかどうかしらべる関数
	var CanMove = function(pos){
		for(var i = 0; i < 12; i++){
			if(CanGo[i][selectedKoma]){
				if(pos.rank == FromClickDan + Direction[i].rank && pos.file == FromClickSuji + Direction[i].file)
					return 1;

				if(CanJump[i][selectedKoma]){
					for(var j = 1; j <= 8; j++){
						var moved = new PiecePos(0,0);
						moved.rank = FromClickDan + Direction[i].rank * j; moved.file = FromClickSuji + Direction[i].file * j;
						if(pos.rank == moved.rank && pos.file == moved.file)
							return 1;
						if(board[moved.rank][moved.file] != EMPTY)
							break;
					}
				}

			}
		}
		return 0;
	}


	var IsControl = function(pos,sengo){
		for(var i = 1; i <= 9; i++){
			for(var j = 1; j <= 9; j++){
				var piece = board[i][j];
				if(piece != EMPTY && Self(piece,sengo)){
					var start = new PiecePos(0,0);
					start.rank = i; start.file = j;

					for(var k = 0; k < 12; k++){
						var moved = new PiecePos(0,0);
						if(CanGo[k][piece]){
							moved.rank  = start.rank + Direction[k].rank;
							moved.file = start.file + Direction[k].file;
							if(Self(board[moved.rank][moved.file],sengo) || board[moved.rank][moved.file] == OUT_OF_BOARD)
								continue;
							if(moved.rank == pos.rank && moved.file == pos.file)
								return 1;

							if(CanJump[k][piece]){
								for(var l = 0; l < 8; l++){
									moved.rank  += Direction[k].rank;
									moved.file += Direction[k].file;
									if(Self(board[moved.rank][moved.file],sengo) || board[moved.rank][moved.file] == OUT_OF_BOARD)
										break;
									if(moved.rank == pos.rank && moved.file == pos.file)
										return 1;
									if(board[moved.rank][moved.file] != EMPTY)
										break;

								}

							}
						}
					}
				}

			}
		}
		return 0;

	}

	function PiecePos(rank,file,piece){
		this.rank  = rank;
		this.file  = file;
		this.piece = piece;
	}

	PiecePos.prototype = {
		Add: function(pos1,pos2){
			this.rank = pos1.rank + pos2.rank;
			this.file = pos1.file + pos2.file;
		}
	}

	function Move(from,to,piece,promotion,capture){
		this.from = from;
		this.to   = to;
		this.piece = piece;
		this.promotion = promotion;
		this.capture = capture;
	}


	//関数のPosition positionとBoardの関係がいまいちわからんpositionは全体のことかな?と思う
	//onloadで行われている関数,インスタンス作るイメージかな?
	function Position(){
		this.Board = [];  //将棋盤

		this.Capture = [];  //駒台
		this.Capture[0] = [];  //駒台(先手と予想)
		this.Capture[1] = [];  //駒台(後手と予想)

		this.FuFlg = [];  //選択か成か
		this.FuFlg[0] = [];  //Fuflgに0行を作成,空の配列
		this.FuFlg[1] = [];  //Fuflgに1行を作成,空の配列

		//Boardに配列構造作成 11×11 9×9か将棋盤,回りは囲われてるだけ,outofboard将棋盤の外
		for(var i = 0; i <= 10; i++){
			this.Board[i] = [];
			for(var j = 0; j <= 10; j++){
				this.Board[i][j] = OUT_OF_BOARD;
			}
		}

		//Boardの9×9は将棋盤の中
		for(var i = 1; i <= 9; i++){
			for(var j = 1; j <= 9; j++){
				this.Board[i][j] = EMPTY;
			}
		}

		for(var i = 0; i <= 1; i++){
			for(var j = 0; j <= HI; j++){
				this.Capture[i][j] = EMPTY;
			}
		}

		for(var i = 1; i <= 9; i++){
			this.FuFlg[0][i] = false;
			this.FuFlg[1][i] = false;
		}

		this.turn = true;
		this.blackKingPos = new PiecePos(0,0);
		this.whiteKingPos = new PiecePos(0,0);

	}

	//Positionのプロトタイプ
	Position.prototype = {

		//SearchKing: function(){},
		//EvalPiece: function(){},

		//無名関数:このBoardが将棋盤だからここが見せられればよい
		Set_dbValue: function(){
			this.Board[1][1] = /*[[${position.board11}]]*/
			this.Board[1][2] = /*[[${position.board12}]]*/
			this.Board[1][3] = /*[[${position.board13}]]*/
			this.Board[1][4] = /*[[${position.board14}]]*/
			this.Board[1][5] = /*[[${position.board15}]]*/
			this.Board[1][6] = /*[[${position.board16}]]*/
			this.Board[1][7] = /*[[${position.board17}]]*/
			this.Board[1][8] = /*[[${position.board18}]]*/
			this.Board[1][9] = /*[[${position.board19}]]*/
			this.Board[2][1] = /*[[${position.board21}]]*/
			this.Board[2][2] = /*[[${position.board22}]]*/
			this.Board[2][3] = /*[[${position.board23}]]*/
			this.Board[2][4] = /*[[${position.board24}]]*/
			this.Board[2][5] = /*[[${position.board25}]]*/
			this.Board[2][6] = /*[[${position.board26}]]*/
			this.Board[2][7] = /*[[${position.board27}]]*/
			this.Board[2][8] = /*[[${position.board28}]]*/
			this.Board[2][9] = /*[[${position.board29}]]*/
			this.Board[3][1] = /*[[${position.board31}]]*/
			this.Board[3][2] = /*[[${position.board32}]]*/
			this.Board[3][3] = /*[[${position.board33}]]*/
			this.Board[3][4] = /*[[${position.board34}]]*/
			this.Board[3][5] = /*[[${position.board35}]]*/
			this.Board[3][6] = /*[[${position.board36}]]*/
			this.Board[3][7] = /*[[${position.board37}]]*/
			this.Board[3][8] = /*[[${position.board38}]]*/
			this.Board[3][9] = /*[[${position.board39}]]*/
			this.Board[4][1] = /*[[${position.board41}]]*/
			this.Board[4][2] = /*[[${position.board42}]]*/
			this.Board[4][3] = /*[[${position.board43}]]*/
			this.Board[4][4] = /*[[${position.board44}]]*/
			this.Board[4][5] = /*[[${position.board45}]]*/
			this.Board[4][6] = /*[[${position.board46}]]*/
			this.Board[4][7] = /*[[${position.board47}]]*/
			this.Board[4][8] = /*[[${position.board48}]]*/
			this.Board[4][9] = /*[[${position.board49}]]*/
			this.Board[5][1] = /*[[${position.board51}]]*/
			this.Board[5][2] = /*[[${position.board52}]]*/
			this.Board[5][3] = /*[[${position.board53}]]*/
			this.Board[5][4] = /*[[${position.board54}]]*/
			this.Board[5][5] = /*[[${position.board55}]]*/
			this.Board[5][6] = /*[[${position.board56}]]*/
			this.Board[5][7] = /*[[${position.board57}]]*/
			this.Board[5][8] = /*[[${position.board58}]]*/
			this.Board[5][9] = /*[[${position.board59}]]*/
			this.Board[6][1] = /*[[${position.board61}]]*/
			this.Board[6][2] = /*[[${position.board62}]]*/
			this.Board[6][3] = /*[[${position.board63}]]*/
			this.Board[6][4] = /*[[${position.board64}]]*/
			this.Board[6][5] = /*[[${position.board65}]]*/
			this.Board[6][6] = /*[[${position.board66}]]*/
			this.Board[6][7] = /*[[${position.board67}]]*/
			this.Board[6][8] = /*[[${position.board68}]]*/
			this.Board[6][9] = /*[[${position.board69}]]*/
			this.Board[7][1] = /*[[${position.board71}]]*/
			this.Board[7][2] = /*[[${position.board72}]]*/
			this.Board[7][3] = /*[[${position.board73}]]*/
			this.Board[7][4] = /*[[${position.board74}]]*/
			this.Board[7][5] = /*[[${position.board75}]]*/
			this.Board[7][6] = /*[[${position.board76}]]*/
			this.Board[7][7] = /*[[${position.board77}]]*/
			this.Board[7][8] = /*[[${position.board78}]]*/
			this.Board[7][9] = /*[[${position.board79}]]*/
			this.Board[8][1] = /*[[${position.board81}]]*/
			this.Board[8][2] = /*[[${position.board82}]]*/
			this.Board[8][3] = /*[[${position.board83}]]*/
			this.Board[8][4] = /*[[${position.board84}]]*/
			this.Board[8][5] = /*[[${position.board85}]]*/
			this.Board[8][6] = /*[[${position.board86}]]*/
			this.Board[8][7] = /*[[${position.board87}]]*/
			this.Board[8][8] = /*[[${position.board88}]]*/
			this.Board[8][9] = /*[[${position.board89}]]*/
			this.Board[9][1] = /*[[${position.board91}]]*/
			this.Board[9][2] = /*[[${position.board92}]]*/
			this.Board[9][3] = /*[[${position.board93}]]*/
			this.Board[9][4] = /*[[${position.board94}]]*/
			this.Board[9][5] = /*[[${position.board95}]]*/
			this.Board[9][6] = /*[[${position.board96}]]*/
			this.Board[9][7] = /*[[${position.board97}]]*/
			this.Board[9][8] = /*[[${position.board98}]]*/
			this.Board[9][9] = /*[[${position.board99}]]*/

			//まさかのcapture0が後手の駒台!?
			this.Capture[0][0] = /*[[${position.capture00}]]*/
			this.Capture[0][1] = /*[[${position.capture01}]]*/
			this.Capture[0][2] = /*[[${position.capture02}]]*/
			this.Capture[0][3] = /*[[${position.capture03}]]*/
			this.Capture[0][4] = /*[[${position.capture04}]]*/
			this.Capture[0][5] = /*[[${position.capture05}]]*/
			this.Capture[0][6] = /*[[${position.capture06}]]*/
			this.Capture[0][7] = /*[[${position.capture07}]]*/
			this.Capture[1][0] = /*[[${position.capture10}]]*/
			this.Capture[1][1] = /*[[${position.capture11}]]*/
			this.Capture[1][2] = /*[[${position.capture12}]]*/
			this.Capture[1][3] = /*[[${position.capture13}]]*/
			this.Capture[1][4] = /*[[${position.capture14}]]*/
			this.Capture[1][5] = /*[[${position.capture15}]]*/
			this.Capture[1][6] = /*[[${position.capture16}]]*/
			this.Capture[1][7] = /*[[${position.capture17}]]*/

			this.FuFlg[0][1] = /*[[${position.fuflg01}]]*/
			this.FuFlg[0][2] = /*[[${position.fuflg02}]]*/
			this.FuFlg[0][3] = /*[[${position.fuflg03}]]*/
			this.FuFlg[0][4] = /*[[${position.fuflg04}]]*/
			this.FuFlg[0][5] = /*[[${position.fuflg05}]]*/
			this.FuFlg[0][6] = /*[[${position.fuflg06}]]*/
			this.FuFlg[0][7] = /*[[${position.fuflg07}]]*/
			this.FuFlg[0][8] = /*[[${position.fuflg08}]]*/
			this.FuFlg[0][9] = /*[[${position.fuflg09}]]*/
			this.FuFlg[1][1] = /*[[${position.fuflg11}]]*/
			this.FuFlg[1][2] = /*[[${position.fuflg12}]]*/
			this.FuFlg[1][3] = /*[[${position.fuflg13}]]*/
			this.FuFlg[1][4] = /*[[${position.fuflg14}]]*/
			this.FuFlg[1][5] = /*[[${position.fuflg15}]]*/
			this.FuFlg[1][6] = /*[[${position.fuflg16}]]*/
			this.FuFlg[1][7] = /*[[${position.fuflg17}]]*/
			this.FuFlg[1][8] = /*[[${position.fuflg18}]]*/
			this.FuFlg[1][9] = /*[[${position.fuflg19}]]*/

			this.blackKingPos.rank = /*[[${position.brank}]]*/
			this.blackKingPos.file = /*[[${position.bfile}]]*/
			this.whiteKingPos.rank = /*[[${position.wrank}]]*/
			this.whiteKingPos.file = /*[[${position.wfile}]]*/

			this.turn = /*[[${position.teban}]]*/

			this.Board[0][0] = 0;

// 			for(var i = 1; i <= 9; i++){
// 				this.FuFlg[0][i] = true;
// 				this.FuFlg[1][i] = true;
// 			}

		},

		//positionをかえる候補
		do_move: function(move){
			if(move.from.file == 0 && move.from.rank == 0){
				this.Board[move.to.rank][move.to.file] = move.piece;
				this.Capture[+this.turn][move.piece & ~ENEMY]--;
				if((move.piece & ~ENEMY) == FU)this.FuFlg[+this.turn][move.to.file] = true;
				//ajaxをはる
				console.log("タイプ1")

// 				console.log("move.from.rank : " + move.from.rank + " move.from.file : " + move.from.file +
// 						" move.to.rank : " + move.to.rank + " move.to.file : " + move.to.file +
// 						" this.Board[move.to.rank][move.to.file] : " + this.Board[move.to.rank][move.to.file] +
// 						" this.Capture[+this.turn][move.piece & ~ENEMY] : " + this.Capture[+this.turn][move.piece & ~ENEMY] +
//						" capture[x][] : " + +this.turn +
//						" capture[][y] : " + move.piece & ~ENEMY +
// 						" this.FuFlg[+this.turn][move.to.file] : " + this.FuFlg[+this.turn][move.to.file] +
//						" Fuflg[x][] : " + +this.turn +
//						" Fuflg[][y] : " + move.to.file +
// 						" this.turn : " + !this.turn )

				 var model1 = {
					"from_rank" : move.from.rank,
					"from_file" : move.from.file,
					"to_rank" : move.to.rank,
					"to_file" : move.to.file,
					"board" : this.Board[move.to.rank][move.to.file],
					"capture" : this.Capture[+this.turn][move.piece & ~ENEMY],
					"capturex" : +this.turn,
					"capturey" : move.piece & ~ENEMY,
					"fuflg" : this.FuFlg[+this.turn][move.to.file],
					"fuflgx" : +this.turn,
					"fuflgy" : move.to.file,
					"turn" : !this.turn
	    		};
				$.ajax({
					url : '/move1',
					type : 'POST',
					data : JSON.stringify(model1),
					contentType : 'application/json',
					error : function() {
						alert("error");
					},
					success : function() {
						console.log("success");
					}
				});

				this.turn = !this.turn;

			}else{
				var temp = this.Board[move.to.rank][move.to.file];
				this.Board[move.to.rank][move.to.file] = this.Board[move.from.rank][move.from.file];
				this.Board[move.from.rank][move.from.file] = EMPTY;

				if((move.piece & ~ENEMY) == OU){
					if(move.piece == OU){
						this.blackKingPos.rank = move.to.rank;
						this.blackKingPos.file = move.to.file;
					}else{
						this.whiteKingPos.rank = move.to.rank;
						this.whiteKingPos.file = move.to.file;
					}
				}

				if(move.promotion){
					this.Board[move.to.rank][move.to.file] += PROMOTED;
				}

				if(move.capture != EMPTY && Koma(move.capture) && move.capture == temp){
					this.Capture[+this.turn][move.capture & ~ENEMY & ~PROMOTED]++;
					if((move.capture & ~ENEMY) == FU)this.FuFlg[+!this.turn][move.to.file] = false;
				}

				if((move.piece & ~ENEMY) == FU && move.promotion)(this.turn) ? this.FuFlg[1][move.to.file] = false : this.FuFlg[0][move.to.file] = false;
// 				if((move.piece & ~ENEMY) == FU && move.promotion){
// 					if(this.turn){
// 						this.Fuflg[1][move.to.file] = false;
// 					}else{
// 						this.Fuflg[0][move.to.file] = false;
// 					}
// 				}
				//ajaxを貼る
				//console.log("タイプ2")

// 				console.log("move.from.rank : " + move.from.rank + " move.from.file : " + move.from.file +
// 						" move.to.rank : " + move.to.rank + " move.to.file : " + move.to.file +
// 						" this.Board[move.to.rank][move.to.file] : " + this.Board[move.to.rank][move.to.file] +
// 						" this.Capture[+this.turn][move.capture & ~ENEMY & ~PROMOTED] :" + this.Capture[+this.turn][move.capture & ~ENEMY & ~PROMOTED] +
// 						" capture[x][] :" + +this.turn +
// 						" capture[][y] :" + move.capture & ~ENEMY & ~PROMOTED +
// 						" this.FuFlg[1][move.to.file] :" + this.FuFlg[1][move.to.file] +
// 						" this.FuFlg[0][move.to.file] :" + this.FuFlg[0][move.to.file] +
// 						" this.turn : " + !this.turn +
// 						" this.blackKingPos.rank :" + this.blackKingPos.rank + " this.blackKingPos.file :" + this.blackKingPos.file +
// 						" this.whiteKingPos.rank :" + this.whiteKingPos.rank + " this.whiteKingPos.file :" + this.whiteKingPos.file )

				var model2 = {
					"from_rank" : move.from.rank,
					"from_file" : move.from.file,
					"to_rank" : move.to.rank,
					"to_file" : move.to.file,
					"board" : this.Board[move.to.rank][move.to.file],
					"capture" : this.Capture[+this.turn][move.capture & ~ENEMY & ~PROMOTED],
					"capturex" : +this.turn,
					"capturey" : move.capture & ~ENEMY & ~PROMOTED,
					"fuflg1movetofile" : this.FuFlg[1][move.to.file],
					"fuflg0movetofile" : this.FuFlg[0][move.to.file],
					"blackkingposrank" : this.blackKingPos.rank,
					"blackkingposfile" : this.blackKingPos.file,
					"whitekingposrank" : this.whiteKingPos.rank,
					"whitekingposfile" : this.whiteKingPos.file,
					"turn" : !this.turn
	    		};
				$.ajax({
					url : '/move2',
					type : 'POST',
					data : JSON.stringify(model2),
					contentType : 'application/json',
					error : function() {
						alert("error");
					},
					success : function() {
						console.log("success");
					}
				});

 				this.turn = !this.turn;

//				大元なので消さない
// 				var model = {
// 					"from_rank" : move.from.rank,
// 					"from_file" : move.from.file,
// 					"to_rank" : move.to.rank,
// 					"to_file" : move.to.file,
// 					"board" : this.Board[move.to.rank][move.to.file]
// 	    		};
// 				$.ajax({
// 					url : '/move',
// 					type : 'POST',
// 					data : JSON.stringify(model),
// 					contentType : 'application/json',
// 					error : function() {
// 						alert("error");
// 					},
// 					success : function() {
// 						console.log("success");
// 					}
// 				});

			}
		},

		undo_move: function(move){
			if(move.from.file == 0 && move.from.rank == 0){
				this.Board[move.to.rank][move.to.file] = EMPTY;
				this.Capture[+!this.turn][move.piece & ~ENEMY]++;
				if((move.piece & ~ENEMY) == FU)this.FuFlg[+!this.turn][move.to.file] = false;
				//ajaxをはる
				console.log("タイプ3")
				this.turn = !this.turn;
				console.log("move.from.rank : " + move.from.rank + " move.from.file : " + move.from.file +
						" move.to.rank : " + move.to.rank + " move.to.file : " + move.to.file +
						" this.Board[move.from.rank][move.from.file] : " + this.Board[move.from.rank][move.from.file] +
						" this.Board[move.to.rank][move.to.file] : " + this.Board[move.to.rank][move.to.file] +
						" this.Capture[+this.turn][move.piece & ~ENEMY] : " + this.Capture[+this.turn][move.piece & ~ENEMY] +
						" capture[x][] : " + +this.turn +
						" capture[][y] : " + move.piece & ~ENEMY +
						" this.FuFlg[+this.turn][move.to.file] : " + this.FuFlg[+this.turn][move.to.file] +
						" Fuflg[x][] : " + +this.turn +
						" Fuflg[][y] : " + move.to.file +
						" this.turn : " + this.turn )

				var model3 = {
					"from_rank" : move.from.rank,
					"from_file" : move.from.file,
					"to_rank" : move.to.rank,
					"to_file" : move.to.file,
					"boardfrom " : this.Board[move.from.rank][move.from.file],
					"board" : this.Board[move.to.rank][move.to.file],
					"capture" : this.Capture[+this.turn][move.piece & ~ENEMY],
					"capturex" : +this.turn,
					"capturey" : move.piece & ~ENEMY,
					"fuflg" : this.FuFlg[+this.turn][move.to.file],
					"fuflgx" : +this.turn,
					"fuflgy" : move.to.file,
					"turn" : this.turn
	    		};
				$.ajax({
					url : '/move3',
					type : 'POST',
					data : JSON.stringify(model3),
					contentType : 'application/json',
					error : function() {
						alert("error");
					},
					success : function() {
						console.log("success");
					}
				});



			}

			else{
				this.Board[move.from.rank][move.from.file] = this.Board[move.to.rank][move.to.file];
				this.Board[move.to.rank][move.to.file] = EMPTY;

				if((move.piece & ~ENEMY) == OU){
					if(move.piece == OU ){
						this.blackKingPos.rank  = move.from.rank;
						this.blackKingPos.file  = move.from.file;
					}else{
						this.whiteKingPos.rank  = move.from.rank;
						this.whiteKingPos.file  = move.from.file;
					}
				}

				if(move.promotion)this.Board[move.from.rank][move.from.file] -= PROMOTED;

				if(move.capture != EMPTY && Koma(move.capture)){
					this.Board[move.to.rank][move.to.file] = move.capture;
					this.Capture[+!this.turn][move.capture & ~ENEMY & ~PROMOTED]--;
					if((move.capture & ~ENEMY) == FU)this.FuFlg[+this.turn][move.to.file] = true;
				}

				if((move.piece & ~ENEMY) == FU && move.promotion)(!this.turn) ? this.FuFlg[1][move.to.file] = true : this.FuFlg[0][move.to.file] = true;

				//ここにfuflgについての新しい記入fuflg[1][] ℓ865～957
				if((this.Board[1][1] != 1) && (this.Board[2][1] != 1)  && (this.Board[3][1] != 1) && (this.Board[4][1] != 1) && (this.Board[5][1] != 1) && (this.Board[6][1] != 1) && (this.Board[7][1] != 1) && (this.Board[8][1] != 1) && (this.Board[9][1] != 1)){
					this.FuFlg[1][1] = false;
				}else{
					this.FuFlg[1][1] = true;
				}
				if((this.Board[1][2] != 1) && (this.Board[2][2] != 1)  && (this.Board[3][2] != 1) && (this.Board[4][2] != 1) && (this.Board[5][2] != 1) && (this.Board[6][2] != 1) && (this.Board[7][2] != 1) && (this.Board[8][2] != 1) && (this.Board[9][2] != 1)){
					this.FuFlg[1][2] = false;
				}else{
					this.FuFlg[1][2] = true;
				}
				if((this.Board[1][3] != 1) && (this.Board[2][3] != 1)  && (this.Board[3][3] != 1) && (this.Board[4][3] != 1) && (this.Board[5][3] != 1) && (this.Board[6][3] != 1) && (this.Board[7][3] != 1) && (this.Board[8][3] != 1) && (this.Board[9][3] != 1)){
					this.FuFlg[1][3] = false;
				}else{
					this.FuFlg[1][3] = true;
				}
				if((this.Board[1][4] != 1) && (this.Board[2][4] != 1)  && (this.Board[3][4] != 1) && (this.Board[4][4] != 1) && (this.Board[5][4] != 1) && (this.Board[6][4] != 1) && (this.Board[7][4] != 1) && (this.Board[8][4] != 1) && (this.Board[9][4] != 1)){
					this.FuFlg[1][4] = false;
				}else{
					this.FuFlg[1][4] = true;
				}
				if((this.Board[1][5] != 1) && (this.Board[2][5] != 1)  && (this.Board[3][5] != 1) && (this.Board[4][5] != 1) && (this.Board[5][5] != 1) && (this.Board[6][5] != 1) && (this.Board[7][5] != 1) && (this.Board[8][5] != 1) && (this.Board[9][5] != 1)){
					this.FuFlg[1][5] = false;
				}else{
					this.FuFlg[1][5] = true;
				}
				if((this.Board[1][6] != 1) && (this.Board[2][6] != 1)  && (this.Board[3][6] != 1) && (this.Board[4][6] != 1) && (this.Board[5][6] != 1) && (this.Board[6][6] != 1) && (this.Board[7][6] != 1) && (this.Board[8][6] != 1) && (this.Board[9][6] != 1)){
					this.FuFlg[1][6] = false;
				}else{
					this.FuFlg[1][6] = true;
				}
				if((this.Board[1][7] != 1) && (this.Board[2][7] != 1)  && (this.Board[3][7] != 1) && (this.Board[4][7] != 1) && (this.Board[5][7] != 1) && (this.Board[6][7] != 1) && (this.Board[7][7] != 1) && (this.Board[8][7] != 1) && (this.Board[9][7] != 1)){
					this.FuFlg[1][7] = false;
				}else{
					this.FuFlg[1][7] = true;
				}
				if((this.Board[1][8] != 1) && (this.Board[2][8] != 1)  && (this.Board[3][8] != 1) && (this.Board[4][8] != 1) && (this.Board[5][8] != 1) && (this.Board[6][8] != 1) && (this.Board[7][8] != 1) && (this.Board[8][8] != 1) && (this.Board[9][8] != 1)){
					this.FuFlg[1][8] = false;
				}else{
					this.FuFlg[1][8] = true;
				}
				if((this.Board[1][9] != 1) && (this.Board[2][9] != 1)  && (this.Board[3][9] != 1) && (this.Board[4][9] != 1) && (this.Board[5][9] != 1) && (this.Board[6][9] != 1) && (this.Board[7][9] != 1) && (this.Board[8][9] != 1) && (this.Board[9][9] != 1)){
					this.FuFlg[1][9] = false;
				}else{
					this.FuFlg[1][9] = true;
				}

				//fuflgについての新しい記入fuflg[0][]
				if((this.Board[1][1] != 17) && (this.Board[2][1] != 17)  && (this.Board[3][1] != 17) && (this.Board[4][1] != 17) && (this.Board[5][1] != 17) && (this.Board[6][1] != 17) && (this.Board[7][1] != 17) && (this.Board[8][1] != 17) && (this.Board[9][1] != 17)){
					this.FuFlg[0][1] = false;
				}else{
					this.FuFlg[0][1] = true;
				}
				if((this.Board[1][2] != 17) && (this.Board[2][2] != 17)  && (this.Board[3][2] != 17) && (this.Board[4][2] != 17) && (this.Board[5][2] != 17) && (this.Board[6][2] != 17) && (this.Board[7][2] != 17) && (this.Board[8][2] != 17) && (this.Board[9][2] != 17)){
					this.FuFlg[0][2] = false;
				}else{
					this.FuFlg[0][2] = true;
				}
				if((this.Board[1][3] != 17) && (this.Board[2][3] != 17)  && (this.Board[3][3] != 17) && (this.Board[4][3] != 17) && (this.Board[5][3] != 17) && (this.Board[6][3] != 17) && (this.Board[7][3] != 17) && (this.Board[8][3] != 17) && (this.Board[9][3] != 17)){
					this.FuFlg[0][3] = false;
				}else{
					this.FuFlg[0][3] = true;
				}
				if((this.Board[1][4] != 17) && (this.Board[2][4] != 17)  && (this.Board[3][4] != 17) && (this.Board[4][4] != 17) && (this.Board[5][4] != 17) && (this.Board[6][4] != 17) && (this.Board[7][4] != 17) && (this.Board[8][4] != 17) && (this.Board[9][4] != 17)){
					this.FuFlg[0][4] = false;
				}else{
					this.FuFlg[0][4] = true;
				}
				if((this.Board[1][5] != 17) && (this.Board[2][5] != 17)  && (this.Board[3][5] != 17) && (this.Board[4][5] != 17) && (this.Board[5][5] != 17) && (this.Board[6][5] != 17) && (this.Board[7][5] != 17) && (this.Board[8][5] != 17) && (this.Board[9][5] != 17)){
					this.FuFlg[0][5] = false;
				}else{
					this.FuFlg[0][5] = true;
				}
				if((this.Board[1][6] != 17) && (this.Board[2][6] != 17)  && (this.Board[3][6] != 17) && (this.Board[4][6] != 17) && (this.Board[5][6] != 17) && (this.Board[6][6] != 17) && (this.Board[7][6] != 17) && (this.Board[8][6] != 17) && (this.Board[9][6] != 17)){
					this.FuFlg[0][6] = false;
				}else{
					this.FuFlg[0][6] = true;
				}
				if((this.Board[1][7] != 17) && (this.Board[2][7] != 17)  && (this.Board[3][7] != 17) && (this.Board[4][7] != 17) && (this.Board[5][7] != 17) && (this.Board[6][7] != 17) && (this.Board[7][7] != 17) && (this.Board[8][7] != 17) && (this.Board[9][7] != 17)){
					this.FuFlg[0][7] = false;
				}else{
					this.FuFlg[0][7] = true;
				}
				if((this.Board[1][8] != 17) && (this.Board[2][8] != 17)  && (this.Board[3][8] != 17) && (this.Board[4][8] != 17) && (this.Board[5][8] != 17) && (this.Board[6][8] != 17) && (this.Board[7][8] != 17) && (this.Board[8][8] != 17) && (this.Board[9][8] != 17)){
					this.FuFlg[0][8] = false;
				}else{
					this.FuFlg[0][8] = true;
				}
				if((this.Board[1][9] != 17) && (this.Board[2][9] != 17)  && (this.Board[3][9] != 17) && (this.Board[4][9] != 17) && (this.Board[5][9] != 17) && (this.Board[6][9] != 17) && (this.Board[7][9] != 17) && (this.Board[8][9] != 17) && (this.Board[9][9] != 17)){
					this.FuFlg[0][9] = false;
				}else{
					this.FuFlg[0][9] = true;
				}

				//ajaxをはる
				console.log("タイプ4")

				this.turn = !this.turn;
				console.log("fuflg[0][6] :" + this.FuFlg[0][6]);
// 				console.log("move.from.rank : " + move.from.rank + " move.from.file : " + move.from.file +
// 						" move.to.rank : " + move.to.rank + " move.to.file : " + move.to.file +
// 						" this.Board[move.from.rank][move.from.file] : " + this.Board[move.from.rank][move.from.file] +
// 						" this.Board[move.to.rank][move.to.file] : " + this.Board[move.to.rank][move.to.file] +
// 						" this.Capture[+this.turn][move.capture & ~ENEMY & ~PROMOTED] :" + this.Capture[+this.turn][move.capture & ~ENEMY & ~PROMOTED] +
// 						" this.FuFlg[1][move.to.file] :" + this.FuFlg[1][move.to.file] +
// 						" this.FuFlg[0][move.to.file] :" + this.FuFlg[0][move.to.file] +
// 						" this.turn : " + !this.turn +
// 						" this.blackKingPos.rank :" + this.blackKingPos.rank + " this.blackKingPos.file :" + this.blackKingPos.file +
// 						" this.whiteKingPos.rank :" + this.whiteKingPos.rank + " this.whiteKingPos.file :" + this.whiteKingPos.file )

				var model4 = {
					"from_rank" : move.from.rank,
					"from_file" : move.from.file,
					"to_rank" : move.to.rank,
					"to_file" : move.to.file,
					"board" : this.Board[move.to.rank][move.to.file],
					"boardfrom" : this.Board[move.from.rank][move.from.file],
					"capture" : this.Capture[+this.turn][move.capture & ~ENEMY & ~PROMOTED],
					"capturex" : +this.turn,
					"capturey" : move.capture & ~ENEMY & ~PROMOTED,
					"fuflg1movetofile" : this.FuFlg[1][move.to.file],
					"fuglg0movetofile" : this.FuFlg[0][move.to.file],
					"blackkingposrank" : this.blackKingPos.rank,
					"blackkingposfile" : this.blackKingPos.file,
					"whitekingposrank" : this.whiteKingPos.rank,
					"whitekingposfile" : this.whiteKingPos.file,
					"turn" : this.turn,
					"fuflg01" :this.FuFlg[0][1],
					"fuflg02" :this.FuFlg[0][2],
					"fuflg03" :this.FuFlg[0][3],
					"fuflg04" :this.FuFlg[0][4],
					"fuflg05" :this.FuFlg[0][5],
					"fuflg06" :this.FuFlg[0][6],
					"fuflg07" :this.FuFlg[0][7],
					"fuflg08" :this.FuFlg[0][8],
					"fuflg09" :this.FuFlg[0][9],
					"fuflg11" :this.FuFlg[1][1],
					"fuflg12" :this.FuFlg[1][2],
					"fuflg13" :this.FuFlg[1][3],
					"fuflg14" :this.FuFlg[1][4],
					"fuflg15" :this.FuFlg[1][5],
					"fuflg16" :this.FuFlg[1][6],
					"fuflg17" :this.FuFlg[1][7],
					"fuflg18" :this.FuFlg[1][8],
					"fuflg19" :this.FuFlg[1][9]
	    		};
				$.ajax({
					url : '/move4',
					type : 'POST',
					data : JSON.stringify(model4),
					contentType : 'application/json',
					error : function() {
						alert("error");
					},
					success : function() {
						console.log("success");
					}
				});

			}
		},

		IsControl: function(pos,turn){
			for(var i = 1; i <= 9; i++){
				for(var j = 1; j <= 9; j++){
					var piece = this.Board[i][j];
					if(piece != EMPTY && Self(piece,turn)){
						var start = new PiecePos(0,0);
						start.rank = i; start.file = j;

						for(var k = 0; k < 12; k++){
							var moved = new PiecePos(0,0);
							if(CanGo[k][piece]){
								moved.rank  = start.rank + Direction[k].rank;
								moved.file = start.file + Direction[k].file;
								if(Self(this.Board[moved.rank][moved.file],turn) || this.Board[moved.rank][moved.file] == OUT_OF_BOARD)
									continue;
								if(moved.rank == pos.rank && moved.file == pos.file)
									return 1;
								if(Enemy(this.Board[moved.rank][moved.file],turn))
									continue;

								if(CanJump[k][piece]){
									for(var l = 0; l < 7; l++){
										moved.rank  += Direction[k].rank;
										moved.file  += Direction[k].file;
										if(Self(this.Board[moved.rank][moved.file],turn) || this.Board[moved.rank][moved.file] == OUT_OF_BOARD)
											break;
										if(moved.rank == pos.rank && moved.file == pos.file)
											return 1;
										if(Enemy(this.Board[moved.rank][moved.file],turn))
											break;
									}
								}
							}
						}
					}
				}
			}
			return 0;


		},

		//ある駒が、あるマスに動けるかどうかしらべる関数
		CanMove: function(pos,piece){
			for(var i = 0; i < 12; i++){
				if(CanGo[i][piece]){
					if(pos.rank == clickRank + Direction[i].rank && pos.file == clickFile + Direction[i].file)
						return 1;

					if(CanJump[i][piece]){
						for(var j = 1; j <= 8; j++){
							var moved = new PiecePos(0,0);
							moved.rank = clickRank + Direction[i].rank * j; moved.file = clickFile + Direction[i].file * j;
							if(pos.rank == moved.rank && pos.file == moved.file)
								return 1;
							if(this.Board[moved.rank][moved.file] != EMPTY)
								break;
						}
					}

				}
			}
			return 0;
		},

		CanDrop: function(pos,piece){
			if((piece & ~ENEMY) == KY || (piece & ~ENEMY) == FU){
				if(this.turn && pos.rank <= 1)return 0;
				if(!this.turn && pos.rank >= 9)return 0;

				if((piece & ~ENEMY) == FU){
					if(this.turn && this.FuFlg[+this.turn][pos.file])return 0;
					if(!this.turn && this.FuFlg[+this.turn][pos.file])return 0;
				}
			}

			if((piece & ~ENEMY) == KE){
				if(this.turn && pos.rank <= 2)return 0;
				if(!this.turn && pos.rank >= 8)return 0;
			}

			return 1;

		}
	}


	//将棋盤全体（持ち駒もふくむ）を表示する ここでは!?
	var showBoard = function(p){

		var fragment = document.createDocumentFragment();//"boardのIDを取得"

		for(var rank = 1; rank <= 9; rank++){
			for(var file = 1; file <= 9; file++){
				//alert("rank=" + rank +  "/ file" + file);
				var c = piece_board[p.Board[rank][file]].cloneNode(true); //駒画像の要素を複製コピー作成の感じ
				//c.style.left = 20 + ((file - 1) * 46) + "px"; 元のやつ
				c.style.left = 20 + ((9 - file) * 46) + "px";         //位置を調節
				//c.style.top = 20 + ((rank - 1) * 46) + "px";  元のやつ
				c.style.top = 20 + ((9 - rank) * 46) + "px";          //位置を調節
				c.removeAttribute("id");
				fragment.appendChild(c);   //"board"に駒画像のノードを追加

				if(p.Board[rank][file] != EMPTY && p.Board[rank][file] != OUT_OF_BOARD){  //もしマスに駒があれば①
					(function(){
						var _rank = rank, _file = file;    //rankとfileは1ずつ足されていくので覚えておく
						var ocp_pos = new PiecePos(rank,file);
						c.onclick = function(){   //クリックされたらこの関数が呼び出される
							(p.turn == BlackKoma(p.Board[ocp_pos.rank][ocp_pos.file]) && !PromotionWindowFlg) ? SelectSelfKoma(p,ocp_pos) : SelectEnemyKoma(p,ocp_pos);
						};
					})();
				}

				if(p.Board[rank][file] == EMPTY){    //もしマスに駒がなければ②
					(function(){
						var emp_pos = new PiecePos(rank,file);//emp_pos で一つのマス
						c.onclick = function(){
							SelectEmptyCell(p,emp_pos);
						}
					})();
				}
			}
		}

		b.appendChild(fragment);                                //"board"に駒画像のノードを追加

		//持ち駒の表示

		//先手の持ち駒
		for(var piece = FU; piece <= HI; piece++){
			(function(){
				var _piece = piece;
				if(p.Capture[1][_piece] != EMPTY){
					ShowBlackCapture(p,_piece);
				}
			})();
		}

		//後手の持ち駒
		for(var piece = FU; piece <= HI; piece++){
			(function(){
				var _piece = piece;
				if(p.Capture[0][_piece] != EMPTY){
					ShowWhiteCapture(p,_piece);
				}
			}());
		}

		//手番の表示
		var TebanMessage = document.getElementById("TebanMessage");
		//innerHTMLで表示
		(p.turn) ? TebanMessage.innerHTML = "先手番です<br>" : TebanMessage.innerHTML = "後手番です<br>";
	};


	//手番の駒をクリックしたときにつかう関数
	var SelectSelfKoma = function(p,pos){

		//変える必要ないけど一応
		if(p.turn){
			//slb.style.left =  19 + ((pos.file - 1) * 46) + "px";
			slb.style.left =  19 + ((9 - pos.file) * 46) + "px";
			//slb.style.top = 19 + ((pos.rank - 1) * 46) + "px";
			slb.style.top = 19 + ((9 - pos.rank) * 46) + "px";
			slb.onclick = function(){
				selectedFlgB = false;
				slb.parentElement.removeChild(slb);
			}
			b.appendChild(slb);
		}

		//変える必要ある
		else{
			//slw.style.left = 20 + ((pos.file - 1) * 46) + "px";
			slw.style.left = 20 + ((9 - pos.file) * 46) + "px";
			//slw.style.top = 20 + ((pos.rank - 1) * 46)+ "px";
			slw.style.top = 20 + ((9 - pos.rank) * 46)+ "px";
			slw.onclick = function(){
				selectedFlgB = false;
				slw.parentElement.removeChild(slw);
			}
			b.appendChild(slw);
		}
		selectedFlgB = true;
		selectedFlgC = false;
		selectedPiece = p.Board[pos.rank][pos.file];
		clickRank = pos.rank; clickFile = pos.file;
	};


	//敵の駒をクリックしたときにつかう関数
	var SelectEnemyKoma = function(p,pos){
		var cb = document.getElementById("capture_black"), cw = document.getElementById("capture_white");

		//盤上の駒を選択している状態なら
		if(selectedFlgB && p.CanMove(pos,selectedPiece)){
			var sek_move = new Move();

			var sek_from = new PiecePos(clickRank,clickFile);
			sek_move.from    = sek_from;
			sek_move.to      = pos;
			sek_move.piece   = selectedPiece;
			sek_move.capture = p.Board[pos.rank][pos.file];

			selectedFlgB = false;
			selectedFlgC = false;
			(p.turn) ? b.removeChild(slb) : b.removeChild(slw);

			if((CanPromote(selectedPiece,p.turn,pos.rank,pos.file) || CanPromote(selectedPiece,p.turn,clickRank,clickFile))){
				if(MustPromote(selectedPiece,p.turn,pos.rank,pos.file)){
					sek_move.promotion = true;
					selectedPiece = EMPTY;
 					if(!p.turn){p.do_move(sek_move);}
 					showBoard(p);
// 					var check = (p.turn) ? p.IsControl(p.whiteKingPos,true) : p.IsControl(p.blackKingPos,false);
// 					(check) ? p.undo_move(sek_move) : showBoard(p);
// 					if(check){
// 						p.do_move(sek_move);
// 						showBoard(p);
// 					}else{
// 						showBoard(p);
// 					}
				}
				else{
					ShowPromotionWindow(p,sek_move,pos.rank,pos.file);
				}
			}

			else{
				selectedPiece = EMPTY;
 				if(!p.turn){p.do_move(sek_move);}
 				showBoard(p);
// 				var check = (p.turn) ? p.IsControl(p.whiteKingPos,true) : p.IsControl(p.blackKingPos,false);
// 				(check) ? p.undo_move(sek_move) : showBoard(p);
// 				if(check){
// 					p.do_move(sek_move);
// 					showBoard(p);
// 				}else{
// 					showBoard(p);
// 				}
			}
		}
		//持ち駒を選択している状態なら
		if(selectedFlgC){
			(p.turn) ? cb.removeChild(slb) : cw.removeChild(slw);
		}
	selectedFlgC = false;

	}


	//空のマスをクリックしたときにつかう関数
	var SelectEmptyCell = function(p,pos){
		var cb = document.getElementById("capture_black"), cw = document.getElementById("capture_white");

		var sec_move = new Move();

		//もし駒が選択された状態なら
		if(selectedFlgB && p.CanMove(pos,selectedPiece)){

			var sec_from = new PiecePos(clickRank,clickFile);
			sec_move.from    = sec_from;
			sec_move.to      = pos;
			sec_move.piece   = selectedPiece;
			sec_move.capture = EMPTY;

			selectedFlgB = false;
			selectedFlgC = false;
			(p.turn) ? b.removeChild(slb) : b.removeChild(slw);

			if(CanPromote(selectedPiece,p.turn,pos.rank,pos.file) || CanPromote(selectedPiece,p.turn,clickRank,clickFile)){
				if(MustPromote(selectedPiece,p.turn,pos.rank,pos.file)){
					sec_move.promotion = true;
					selectedPiece = EMPTY;
 					if(!p.turn){p.do_move(sec_move);}
 					showBoard(p);
// 					var check = (p.turn) ? p.IsControl(p.whiteKingPos,true) : p.IsControl(p.blackKingPos,false);
// 					(check) ? p.undo_move(sec_move) : showBoard(p);
// 					if(check){
// 						p.do_move(sec_move);
// 						showBoard(p)
// 					}else{
// 						showBoard(p);
// 					}
				}
				else{
					ShowPromotionWindow(p,sec_move,pos.rank,pos.file);
				}
			}

			else{
				selectedPiece = EMPTY;
 				if(!p.turn){p.do_move(sec_move);}
 				showBoard(p);
// 				var check = (p.turn) ? p.IsControl(p.whiteKingPos,true) : p.IsControl(p.blackKingPos,false);
// 				(check) ? p.undo_move(sec_move) : showBoard(p);
// 				if(check){
// 					p.do_move(sec_move);
// 					showBoard(p);
// 				}else{
// 					showBoard(p);
// 				}
			}
		}

		if(selectedFlgC && p.CanDrop(pos,selectedPiece)){
			var sec_from = new PiecePos(0,0);
			sec_move.from    = sec_from;
			sec_move.to      = pos;
			sec_move.piece   = selectedPiece;
			sec_move.capture = EMPTY;

			(p.turn) ? cb.removeChild(slb) : cw.removeChild(slw);

			if(p.turn){
				while(cb.firstChild){
					cb.removeChild(cb.firstChild);
				}
			}
			else{
				while(cw.firstChild){
					cw.removeChild(cw.firstChild);
				}
			}
			selectedPiece = EMPTY;

			selectedFlgB = false;
			selectedFlgC = false;

  			if(!p.turn){p.do_move(sec_move);}
  			showBoard(p);
// 			var check = (p.turn) ? p.IsControl(p.whiteKingPos,true) : p.IsControl(p.blackKingPos,false);
// 			(check) ? p.undo_move(sec_move) : showBoard(p);
// 			if(check){
// 				p.do_move(sec_move);
// 				showBoard(p);
// 			}else{
// 				showBoard(p);
// 			}

			showBoard(p);
		}
	}


	//先手の持ち駒を表示する関数
	var ShowBlackCapture = function(p,piece){
		var cb = document.getElementById("capture_black"), cw = document.getElementById("capture_white");
		var fragmentB = document.createDocumentFragment(), fragmentC = document.createDocumentFragment();

		for(var i = 1; i <= p.Capture[1][piece]; i++){

			var pcb = piece_black_capture[piece].cloneNode(true);
			//pcb.style.left = !(piece%2)*72+10+(p.Capture[1][piece]-i)*10 + "px"; 元1
			pcb.style.left = (piece%2)*72+30-(p.Capture[1][piece]-i)*10+5 + "px";
			//pcb.style.top = (7-piece-(7-piece)%2)/2*46+10 + "px"; 元2
			pcb.style.top = (piece-(piece)%2)/2*46+10 + "px";

			if(i == p.Capture[1][piece]){
				pcb.onclick = function(){
					if(p.turn && !PromotionWindowFlg){
						//slb.style.left = !(piece%2)*72+8+ "px"; 元3
						slb.style.left = (piece%2)*72+33+ "px";
						//slb.style.top = (7-piece-(7-piece)%2)/2*46+8 + "px"; 元4
						slb.style.top = (piece-(piece)%2)/2*46+8 + "px";
						slb.onclick = function(){
							if(p.turn){
								slb.parentElement.removeChild(slb);
								selectedFlgC = false;
							}
						}

						selectedFlgC = true;
						selectedPiece = piece;
						cb.appendChild(slb);
					}
					if(p.turn){
						selectedFlgB = false;
					}
				}
			}
			fragmentB.appendChild(pcb);
		}
		cb.appendChild(fragmentB);
	}


	//後手の持ち駒を表示する関数
	var ShowWhiteCapture = function(p,piece){
		var cb = document.getElementById("capture_black"), cw = document.getElementById("capture_white");
		var fragmentB = document.createDocumentFragment(), fragmentC = document.createDocumentFragment();
		for(var i = 1; i <= p.Capture[0][piece]; i++){

			var pcw = piece_white_capture[piece].cloneNode(true);
			//pcw.style.left = (piece%2)*72+30-(p.Capture[0][piece]-i)*10+5 + "px"; 元1
			pcw.style.left = !(piece%2)*72+10+(p.Capture[0][piece]-i)*10 + "px";
			//pcw.style.top = (piece-(piece)%2)/2*46+10 + "px"; 元2
			pcw.style.top = (7-piece-(7-piece)%2)/2*46+10 + "px";

			if(i == p.Capture[0][piece]){
				pcw.onclick = function(){
					if(!p.turn  && !PromotionWindowFlg){
						//slw.style.left = (piece%2)*72+33+ "px"; 元3
						slw.style.left = !(piece%2)*72+8+ "px";
						//slw.style.top = (piece-(piece)%2)/2*46+8 + "px"; 元4
						slw.style.top = (7-piece-(7-piece)%2)/2*46+8 + "px";
						slw.onclick = function(){
								slw.parentElement.removeChild(slw);
								selectedFlgC = false;
						}

						selectedFlgC = true;
						selectedPiece = piece | ENEMY;
						cw.appendChild(slw);
					}
					if(!p.turn){
						selectedFlgB = false;
					}
				}
			}
			fragmentC.appendChild(pcw);
		}
		cw.appendChild(fragmentC);
	}


	//成／不成を選択するウインドウを表示する関数
	var ShowPromotionWindow = function(p,move,rank,file){
		var promotion_window = document.getElementById("promotion_window");
		var fragment = document.createDocumentFragment();

		var WindowClickFlg;

		var Show = function (){
			//候補
			//pw_img.style.left = (file - 1) * 46 - 10 + "px";
			pw_img.style.left = (9 - file) * 46 - 10 + "px";
			//pw_img.style.top = 8 + ((rank - 1) * 46) + "px";
			pw_img.style.top = 8 + ((9 - rank) * 46) + "px";

			var ppw = piece_promotion_window[selectedPiece & ~ENEMY];
			//候補
			//ppw.style.left = (file - 1) * 46 +38 + "px";
			ppw.style.left = (9 - file) * 46 +38 + "px";
			//ppw.style.top = 8 + ((rank - 1) * 46) + "px";
			ppw.style.top = 8 + ((9 - rank) * 46) + "px";
			ppw.onclick = function(){
				b.removeChild(pw_img);
				b.removeChild(ppw);
				b.removeChild(pc);
				move.promotion = true;
				PromotionWindowFlg = false;
			}

			//var pc = piece_black_capture[selectedPiece & ~ENEMY & ~PROMOTED];元
			var pc = piece_white_capture[selectedPiece & ~ENEMY & ~PROMOTED];//black↑white
			//候補
			//pc.style.left = (file - 1) * 46 - 8 + "px";
			pc.style.left = (9 - file) * 46 - 8 + "px";
			//pc.style.top = 8 + ((rank - 1) * 46) + "px";
			pc.style.top = 8 + ((9 - rank) * 46) + "px";
			pc.onclick = function(){
				b.removeChild(pw_img);
				b.removeChild(ppw);
				b.removeChild(pc);
				move.promotion = false;
				PromotionWindowFlg = false;
			}

			fragment.appendChild(pw_img);
			fragment.appendChild(ppw);
			fragment.appendChild(pc);

		};

		PromotionWindowFlg = true;
		Show();
		b.appendChild(fragment);

		var timerID = setInterval(function(){
			if(!PromotionWindowFlg){
				clearInterval(timerID);
				timerID = null;
				selectedPiece = EMPTY;
 				if(!p.turn){p.do_move(move);}
 				showBoard(p);
// 				var check = (p.turn) ? p.IsControl(p.whiteKingPos,true) : p.IsControl(p.blackKingPos,false);
// 				(check) ? p.undo_move(move) : showBoard(p);
// 				if(check){
// 					p.do_move(move);
// 					showBoard(p);
// 				}else{
// 					showBoard(p);
// 				}
			}
		},100);
	}

	//ページ読み込み時に以下の処理を実行
	window.onload = function(){

		b = document.getElementById("board");

		//選択フラグを初期化 これらはデータベースと関係ないからok
		selectedFlgB = false;
		selectedFlgC = false;
		PromotionWindowFlg = false;

		//選択した状態の画像のIDを取得
		slb = document.getElementById("selected_black"); slw = document.getElementById("selected_white");

		//pieceにコマ画像のIDを入れておく htmlから取ってきてるってこと!!
		//board.htmlからid="cell_board"でl1で定義された画像を取ってくるってこと
// 		piece_board = [
// 		document.getElementById("cell_board"),
// 		document.getElementById("FU_black"),
// 		document.getElementById("KY_black"),
// 		document.getElementById("KE_black"),
// 		document.getElementById("GI_black"),
// 		document.getElementById("KI_black"),
// 		document.getElementById("KA_black"),
// 		document.getElementById("HI_black"),
// 		document.getElementById("OU_black"),
// 		document.getElementById("TO_black"),
// 		document.getElementById("NY_black"),
// 		document.getElementById("NK_black"),
// 		document.getElementById("NG_black"),
// 		document.getElementById("KI_black"),
// 		document.getElementById("UM_black"),
// 		document.getElementById("RY_black"),
// 		document.getElementById("cell_board"),
// 		document.getElementById("FU_white"),
// 		document.getElementById("KY_white"),
// 		document.getElementById("KE_white"),
// 		document.getElementById("GI_white"),
// 		document.getElementById("KI_white"),
// 		document.getElementById("KA_white"),
// 		document.getElementById("HI_white"),
// 		document.getElementById("OU_white"),
// 		document.getElementById("TO_white"),
// 		document.getElementById("NY_white"),
// 		document.getElementById("NK_white"),
// 		document.getElementById("NG_white"),
// 		document.getElementById("KI_white"),
// 		document.getElementById("UM_white"),
// 		document.getElementById("RY_white"),
// 		document.getElementById("cell_board"),
// 		];

		piece_board = [
			document.getElementById("cell_board"),
			document.getElementById("FU_white"),
			document.getElementById("KY_white"),
			document.getElementById("KE_white"),
			document.getElementById("GI_white"),
			document.getElementById("KI_white"),
			document.getElementById("KA_white"),
			document.getElementById("HI_white"),
			document.getElementById("OU_white"),
			document.getElementById("TO_white"),
			document.getElementById("NY_white"),
			document.getElementById("NK_white"),
			document.getElementById("NG_white"),
			document.getElementById("KI_white"),
			document.getElementById("UM_white"),
			document.getElementById("RY_white"),
			document.getElementById("cell_board"),
			document.getElementById("FU_black"),
			document.getElementById("KY_black"),
			document.getElementById("KE_black"),
			document.getElementById("GI_black"),
			document.getElementById("KI_black"),
			document.getElementById("KA_black"),
			document.getElementById("HI_black"),
			document.getElementById("OU_black"),
			document.getElementById("TO_black"),
			document.getElementById("NY_black"),
			document.getElementById("NK_black"),
			document.getElementById("NG_black"),
			document.getElementById("KI_black"),
			document.getElementById("UM_black"),
			document.getElementById("RY_black"),
			document.getElementById("cell_board"),
			];


// 		piece_black_capture = [
// 		document.getElementById("cell_capture"),
// 		document.getElementById("FU_black_capture"),
// 		document.getElementById("KY_black_capture"),
// 		document.getElementById("KE_black_capture"),
// 		document.getElementById("GI_black_capture"),
// 		document.getElementById("KI_black_capture"),
// 		document.getElementById("KA_black_capture"),
// 		document.getElementById("HI_black_capture")
// 		];

		piece_black_capture = [
		document.getElementById("cell_capture"),
		document.getElementById("FU_white_capture"),
		document.getElementById("KY_white_capture"),
		document.getElementById("KE_white_capture"),
		document.getElementById("GI_white_capture"),
		document.getElementById("KI_white_capture"),
		document.getElementById("KA_white_capture"),
		document.getElementById("HI_white_capture")
		];

// 		piece_white_capture = [
// 		document.getElementById("cell_capture"),
// 		document.getElementById("FU_white_capture"),
// 		document.getElementById("KY_white_capture"),
// 		document.getElementById("KE_white_capture"),
// 		document.getElementById("GI_white_capture"),
// 		document.getElementById("KI_white_capture"),
// 		document.getElementById("KA_white_capture"),
// 		document.getElementById("HI_white_capture")
// 		];


		piece_white_capture = [
		document.getElementById("cell_capture"),
		document.getElementById("FU_black_capture"),
		document.getElementById("KY_black_capture"),
		document.getElementById("KE_black_capture"),
		document.getElementById("GI_black_capture"),
		document.getElementById("KI_black_capture"),
		document.getElementById("KA_black_capture"),
		document.getElementById("HI_black_capture")
		];

		piece_promotion_window = [
		document.getElementById("cell_capture"),
		document.getElementById("TO_window"),
		document.getElementById("NY_window"),
		document.getElementById("NK_window"),
		document.getElementById("NG_window"),
		document.getElementById("cell_capture"),
		document.getElementById("UM_window"),
		document.getElementById("RY_window"),
		];

		pw_img = document.getElementById("pw_img");

		//ここら辺書き換える可能性あり,それかPositionの所
		var p = new Position();

		p.Set_dbValue();



		//将棋盤全体（持ち駒もふくむ）を表示する
		showBoard(p);

	};



	/*]]>*/
	</script>


</head>

<body>

	<div style="display:none">


		<div id="cell_board" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/cell_board.png">
		</div>

		<div id="cell_capture" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/cell_capture.png">
		</div>

		<div id="FU_black" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/fu_black.png">
		</div>

		<div id="KY_black" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/ky_black.png">
		</div>

		<div id="KE_black" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/ke_black.png">
		</div>

		<div id="GI_black" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/gi_black.png">
		</div>

		<div id="KI_black" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/ki_black.png">
		</div>

		<div id="HI_black" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/hi_black.png">
		</div>

		<div id="KA_black" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/ka_black.png">
		</div>

		<div id="OU_black" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/ou_black.png">
		</div>

		<div id="TO_black" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/to_black.png">
		</div>

		<div id="NY_black" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/ny_black.png">
		</div>

		<div id="NK_black" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/nk_black.png">
		</div>

		<div id="NG_black" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/ng_black.png">
		</div>

		<div id="RY_black" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/ry_black.png">
		</div>

		<div id="UM_black" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/um_black.png">
		</div>


		<div id="FU_white" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/fu_white.png">
		</div>

		<div id="KY_white" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/ky_white.png">
		</div>

		<div id="KE_white" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/ke_white.png">
		</div>

		<div id="GI_white" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/gi_white.png">
		</div>

		<div id="KI_white" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/ki_white.png">
		</div>

		<div id="HI_white" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/hi_white.png">
		</div>

		<div id="KA_white" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/ka_white.png">
		</div>

		<div id="OU_white" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/ou_white.png">
		</div>

		<div id="TO_white" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/to_white.png">
		</div>

		<div id="NY_white" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/ny_white.png">
		</div>

		<div id="NK_white" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/nk_white.png">
		</div>

		<div id="NG_white" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/ng_white.png">
		</div>

		<div id="RY_white" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/ry_white.png">
		</div>

		<div id="UM_white" style="position:absolute;width:41px;height:41px">
			<img style="display:block;position:relative;width:41px;height:41px" src="./img/um_white.png">
		</div>

		<div id="FU_black_capture" style="position:absolute;width:40px;height:40px">
			<img style="display:block;position:relative;width:40px;height:40px" src="./img/fu_black_capture.png">
		</div>

		<div id="KY_black_capture" style="position:absolute;width:40px;height:40px">
			<img style="display:block;position:relative;width:40px;height:40px" src="./img/ky_black_capture.png">
		</div>

		<div id="KE_black_capture" style="position:absolute;width:40px;height:40px">
			<img style="display:block;position:relative;width:40px;height:40px" src="./img/ke_black_capture.png">
		</div>

		<div id="GI_black_capture" style="position:absolute;width:40px;height:40px">
			<img style="display:block;position:relative;width:40px;height:40px" src="./img/gi_black_capture.png">
		</div>

		<div id="KI_black_capture" style="position:absolute;width:40px;height:40px">
			<img style="display:block;position:relative;width:40px;height:40px" src="./img/ki_black_capture.png">
		</div>

		<div id="HI_black_capture" style="position:absolute;width:40px;height:40px">
			<img style="display:block;position:relative;width:40px;height:40px" src="./img/hi_black_capture.png">
		</div>

		<div id="KA_black_capture" style="position:absolute;width:40px;height:40px">
			<img style="display:block;position:relative;width:40px;height:40px" src="./img/ka_black_capture.png">
		</div>


		<div id="FU_white_capture" style="position:absolute;width:40px;height:40px">
			<img style="display:block;position:relative;width:40px;height:40px" src="./img/fu_white_capture.png">
		</div>

		<div id="KY_white_capture" style="position:absolute;width:40px;height:40px">
			<img style="display:block;position:relative;width:40px;height:40px" src="./img/ky_white_capture.png">
		</div>

		<div id="KE_white_capture" style="position:absolute;width:40px;height:40px">
			<img style="display:block;position:relative;width:40px;height:40px" src="./img/ke_white_capture.png">
		</div>

		<div id="GI_white_capture" style="position:absolute;width:40px;height:40px">
			<img style="display:block;position:relative;width:40px;height:40px" src="./img/gi_white_capture.png">
		</div>

		<div id="KI_white_capture" style="position:absolute;width:40px;height:40px">
			<img style="display:block;position:relative;width:40px;height:40px" src="./img/ki_white_capture.png">
		</div>

		<div id="HI_white_capture" style="position:absolute;width:40px;height:40px">
			<img style="display:block;position:relative;width:40px;height:40px" src="./img/hi_white_capture.png">
		</div>

		<div id="KA_white_capture" style="position:absolute;width:40px;height:40px">
			<img style="display:block;position:relative;width:40px;height:40px" src="./img/ka_white_capture.png">
		</div>


		<div id="TO_window" style="position:absolute;width:40px;height:40px">
			<img style="display:block;position:relative;width:40px;height:40px" src="./img/to_window.png">
		</div>

		<div id="NK_window" style="position:absolute;width:40px;height:40px">
			<img style="display:block;position:relative;width:40px;height:40px" src="./img/nk_window.png">
		</div>

		<div id="NY_window" style="position:absolute;width:40px;height:40px">
			<img style="display:block;position:relative;width:40px;height:40px" src="./img/ny_window.png">
		</div>

		<div id="NG_window" style="position:absolute;width:40px;height:40px">
			<img style="display:block;position:relative;width:40px;height:40px" src="./img/ng_window.png">
		</div>

		<div id="RY_window" style="position:absolute;width:40px;height:40px">
			<img style="display:block;position:relative;width:40px;height:40px" src="./img/ry_window.png">
		</div>

		<div id="UM_window" style="position:absolute;width:40px;height:40px">
			<img style="display:block;position:relative;width:40px;height:40px" src="./img/um_window.png">
		</div>


		<div id="selected_black" style="position:absolute;width:45px;height:45px">
			<img style="display:block;position:relative;width:45px;height:45px" src=./img/selected_black.png>
		</div>

		<div id="selected_white" style="position:absolute;width:43px;height:43px">
			<img style="display:block;position:relative;width:43px;height:43px" src="./img/selected_white.png">
		</div>

		<div id="pw_img" style="position:absolute;width:92px;height:46px">
			<img style="display:block;position:relative;width:92px;height:46px" src="./img/promotion_window.png">
		</div>

	</div>

	<div style="position:relative;top:10px;left:10px">

		<div id="promotion_window"></div>

		<!-- <div style="position:absolute;width:153px;height:230px;top:255px;left:630px"> 元-->
		<div style="position:absolute;width:153px;height:230px">
			<img src="./img/komadai.png">
			<div id="capture_black"></div>
		</div>

		<div style="position:absolute;width:450px;height:450px;left:170px" id="board">
			<img src=./img/ban.png>
		</div>

		<!-- <div style="position:absolute;width:153px;height:230px"> -->
		<div style="position:absolute;width:153px;height:230px;top:255px;left:630px">
			<img src="./img/komadai.png">
			<div id="capture_white"></div>
		</div>

		<div style = "position:absolute;top:500px"id="TebanMessage"></div>
	</div>

</body>
</html>